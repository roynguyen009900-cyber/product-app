<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en" class="wa-theme-default wa-dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Manager</title>

    <!-- Web Awesome -->
    <link rel="stylesheet" href="https://early.webawesome.com/webawesome@3.0.0-beta.4/dist/styles/themes/default.css">
    <script type="module" src="https://early.webawesome.com/webawesome@3.0.0-beta.4/dist/webawesome.loader.js"></script>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background-image:
                radial-gradient(ellipse at 20% 50%, rgba(124, 92, 252, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(157, 124, 255, 0.06) 0%, transparent 50%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #7c5cfc, #9d7cff, #c084fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .header p {
            color: var(--wa-color-neutral-500);
            font-size: 1.1rem;
            font-weight: 300;
        }

        .stats-container {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }

        /* Card spacing */
        wa-card {
            margin-bottom: 1.5rem;
        }

        wa-card::part(body) {
            padding: var(--wa-space-l);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Form Grid */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
            border-radius: var(--wa-border-radius-l);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table thead th {
            background: var(--wa-color-neutral-100);
            padding: 0.8rem 1rem;
            text-align: left;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--wa-color-neutral-500);
            border-bottom: 1px solid var(--wa-color-neutral-200);
        }

        table tbody td {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid var(--wa-color-neutral-200);
            font-size: 0.9rem;
            vertical-align: middle;
        }

        table tbody tr {
            transition: background 0.15s ease;
        }

        table tbody tr:hover {
            background: var(--wa-color-neutral-50);
        }

        table tbody tr:last-child td {
            border-bottom: none;
        }

        .product-image {
            width: 48px;
            height: 48px;
            border-radius: var(--wa-border-radius-m);
            object-fit: cover;
            border: 1px solid var(--wa-color-neutral-200);
        }

        .product-image-placeholder {
            width: 48px;
            height: 48px;
            border-radius: var(--wa-border-radius-m);
            background: var(--wa-color-neutral-100);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--wa-color-neutral-200);
        }

        .price {
            font-weight: 600;
            color: var(--wa-color-success-600);
        }

        /* Variant expansion */
        .variant-row td {
            background: var(--wa-color-neutral-100);
            padding: 0.5rem 1rem;
            font-size: 0.82rem;
            color: var(--wa-color-neutral-500);
        }

        /* HTMX Loading */
        .htmx-indicator {
            display: none;
        }

        .htmx-request .htmx-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }

        .htmx-request .btn-text {
            display: none;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--wa-color-neutral-500);
        }

        .empty-state wa-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* HTMX transitions */
        .htmx-added {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                <wa-icon name="box-seam" variant="solid" style="font-size: 2rem;"></wa-icon>
                Product Manager
            </h1>
            <p>Manage and browse products from the Famme catalog</p>
            <div class="stats-container">
                <wa-badge variant="success" attention="pulse" pill>
                    <span th:text="${productCount} + ' products in database'">0 products in database</span>
                </wa-badge>
            </div>
        </div>

        <!-- Quick Actions Card -->
        <wa-card>
            <div class="card-header">
                <div class="card-title">
                    <wa-icon name="lightning-charge-fill" style="color: var(--wa-color-warning-500);"></wa-icon>
                    Quick Actions
                </div>
            </div>
            <wa-button variant="brand" hx-get="/products" hx-target="#product-table-container" hx-swap="innerHTML">
                <wa-icon slot="prefix" name="list-ul"></wa-icon>
                <span class="btn-text">Load Products</span>
                <span class="htmx-indicator">
                    <wa-spinner></wa-spinner> Loading...
                </span>
            </wa-button>
            <a href="/search">
                <wa-button variant="neutral">
                    <wa-icon slot="prefix" name="search"></wa-icon>
                    Search Products
                </wa-button>
            </a>
        </wa-card>

        <!-- Add Product Form Card -->
        <wa-card>
            <div class="card-header">
                <div class="card-title">
                    <wa-icon name="plus-circle-fill" style="color: var(--wa-color-brand-500);"></wa-icon>
                    Add New Product
                </div>
            </div>
            <form hx-post="/products" hx-target="#product-table-container" hx-swap="innerHTML" id="add-product-form"
                hx-on::after-request="if(event.detail.successful){ this.querySelectorAll('wa-input').forEach(i => i.value=''); document.getElementById('variants-container').innerHTML=''; document.getElementById('no-variants-hint').classList.remove('hidden'); variantIndex=0; }">
                <div class="form-grid">
                    <wa-input label="Product Title *" name="title" placeholder="e.g. Sport Leggings" required
                        appearance="filled">
                        <wa-icon slot="prefix" name="tag"></wa-icon>
                    </wa-input>
                    <wa-input label="Vendor" name="vendor" placeholder="e.g. Famme" appearance="filled">
                        <wa-icon slot="prefix" name="shop"></wa-icon>
                    </wa-input>
                    <wa-input label="Product Type" name="productType" placeholder="e.g. Leggings" appearance="filled">
                        <wa-icon slot="prefix" name="grid"></wa-icon>
                    </wa-input>
                    <wa-input label="Price" name="price" type="number" step="0.01" placeholder="0.00"
                        appearance="filled">
                        <wa-icon slot="prefix" name="currency-dollar"></wa-icon>
                    </wa-input>
                </div>

                <!-- Variants Section -->
                <div class="variants-section">
                    <div class="variants-header">
                        <span class="variants-title">
                            <wa-icon name="list-ul"></wa-icon>
                            Variants
                        </span>
                        <wa-button type="button" variant="neutral" size="small" onclick="addVariantRow()">
                            <wa-icon slot="prefix" name="plus-lg"></wa-icon>
                            Add Variant
                        </wa-button>
                    </div>
                    <div id="variants-container">
                        <!-- Variant rows will be added here dynamically -->
                    </div>
                    <div id="no-variants-hint" class="no-variants-hint">
                        <wa-icon name="info-circle"></wa-icon>
                        No variants added. Click "Add Variant" to add size/color options.
                    </div>
                </div>

                <wa-button type="submit" variant="brand" style="margin-top: 0.5rem;">
                    <wa-icon slot="prefix" name="floppy"></wa-icon>
                    <span class="btn-text">Add Product</span>
                    <span class="htmx-indicator">
                        <wa-spinner></wa-spinner> Saving...
                    </span>
                </wa-button>
            </form>

            <style>
                .variants-section {
                    margin-top: 1rem;
                    padding: 1rem;
                    border: 1px solid var(--wa-color-neutral-700);
                    border-radius: 8px;
                    background: rgba(255, 255, 255, 0.02);
                }

                .variants-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 0.75rem;
                }

                .variants-title {
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    font-weight: 600;
                    font-size: 0.95rem;
                    color: var(--wa-color-neutral-100);
                }

                .variant-input-row {
                    display: grid;
                    grid-template-columns: 1fr 1fr 0.7fr auto auto;
                    gap: 0.5rem;
                    align-items: end;
                    margin-bottom: 0.5rem;
                    padding: 0.6rem 0.75rem;
                    border-radius: 6px;
                    background: rgba(255, 255, 255, 0.03);
                    border: 1px solid var(--wa-color-neutral-800);
                    animation: slideIn 0.2s ease-out;
                }

                @keyframes slideIn {
                    from {
                        opacity: 0;
                        transform: translateY(-8px);
                    }

                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                .variant-input-row wa-input {
                    --wa-input-height-medium: 36px;
                    font-size: 0.85rem;
                }

                .variant-available {
                    display: flex;
                    align-items: center;
                    padding-bottom: 4px;
                }

                .no-variants-hint {
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    color: var(--wa-color-neutral-400);
                    font-size: 0.85rem;
                    padding: 0.5rem 0;
                }

                .no-variants-hint.hidden {
                    display: none;
                }

                .variant-remove-btn {
                    background: rgba(255, 80, 80, 0.15);
                    border: 1px solid rgba(255, 80, 80, 0.3);
                    color: #ff6b6b;
                    border-radius: 50%;
                    width: 28px;
                    height: 28px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    font-size: 14px;
                    line-height: 1;
                    padding: 0;
                    transition: all 0.15s ease;
                    align-self: center;
                }

                .variant-remove-btn:hover {
                    background: rgba(255, 80, 80, 0.3);
                    border-color: #ff6b6b;
                    transform: scale(1.1);
                }

                @media (max-width: 768px) {
                    .variant-input-row {
                        grid-template-columns: 1fr 1fr;
                    }
                }
            </style>

            <script>
                let variantIndex = 0;

                function addVariantRow() {
                    const container = document.getElementById('variants-container');
                    const hint = document.getElementById('no-variants-hint');
                    hint.classList.add('hidden');

                    const row = document.createElement('div');
                    row.className = 'variant-input-row';
                    row.innerHTML = `
                        <wa-input label="${variantIndex === 0 ? 'Title *' : ''}" name="variantTitles" placeholder="e.g. Black / M" appearance="filled" size="small" required></wa-input>
                        <wa-input label="${variantIndex === 0 ? 'SKU' : ''}" name="variantSkus" placeholder="e.g. BLK-M" appearance="filled" size="small"></wa-input>
                        <wa-input label="${variantIndex === 0 ? 'Price' : ''}" name="variantPrices" type="number" step="0.01" placeholder="0.00" appearance="filled" size="small"></wa-input>
                        <div class="variant-available" title="Available">
                            <wa-checkbox name="variantAvailables" value="true" checked>
                                ${variantIndex === 0 ? 'Avail.' : ''}
                            </wa-checkbox>
                        </div>
                        <button type="button" class="variant-remove-btn" onclick="removeVariantRow(this)" title="Remove variant">âœ•</button>
                    `;
                    container.appendChild(row);
                    variantIndex++;
                }

                function removeVariantRow(btn) {
                    const row = btn.closest('.variant-input-row');
                    row.style.opacity = '0';
                    row.style.transform = 'translateX(20px)';
                    row.style.transition = 'all 0.15s ease-out';
                    setTimeout(() => {
                        row.remove();
                        const container = document.getElementById('variants-container');
                        const hint = document.getElementById('no-variants-hint');
                        if (container.children.length === 0) {
                            hint.classList.remove('hidden');
                            variantIndex = 0;
                        }
                        updateFirstRowLabels();
                    }, 150);
                }

                function updateFirstRowLabels() {
                    const container = document.getElementById('variants-container');
                    const rows = container.querySelectorAll('.variant-input-row');
                    rows.forEach((row, idx) => {
                        const inputs = row.querySelectorAll('wa-input');
                        const checkbox = row.querySelector('wa-checkbox');
                        if (idx === 0) {
                            inputs[0].label = 'Title *';
                            inputs[1].label = 'SKU';
                            inputs[2].label = 'Price';
                            if (checkbox) checkbox.textContent = 'Avail.';
                        } else {
                            inputs[0].label = '';
                            inputs[1].label = '';
                            inputs[2].label = '';
                            if (checkbox) checkbox.textContent = '';
                        }
                    });
                }
            </script>
        </wa-card>

        <!-- Products Table Card -->
        <wa-card>
            <div class="card-header">
                <div class="card-title">
                    <wa-icon name="bar-chart-line-fill" style="color: var(--wa-color-brand-500);"></wa-icon>
                    Product Catalog
                </div>
            </div>
            <div id="product-table-container">
                <div class="empty-state">
                    <wa-icon name="box-seam"></wa-icon>
                    <h3>No products loaded yet</h3>
                    <p>Click "Load Products" to fetch from database, or add one manually.</p>
                </div>
            </div>
        </wa-card>
    </div>
</body>

</html>